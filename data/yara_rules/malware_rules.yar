/*
    MalGuard Sample YARA Rules
    These rules detect common malware patterns and suspicious behaviors
*/

rule EICAR_Test_File {
    meta:
        description = "EICAR antivirus test file"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "low"
        category = "test"
    
    strings:
        $eicar = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
    
    condition:
        $eicar
}

rule Suspicious_PowerShell_Commands {
    meta:
        description = "Detects suspicious PowerShell command patterns"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "high"
        category = "suspicious"
    
    strings:
        $ps1 = "powershell" nocase
        $ps2 = "-encodedcommand" nocase
        $ps3 = "-exec bypass" nocase
        $ps4 = "-windowstyle hidden" nocase
        $ps5 = "invoke-expression" nocase
        $ps6 = "downloadstring" nocase
        $ps7 = "invoke-webrequest" nocase
        $ps8 = "-noprofile" nocase
        $ps9 = "frombase64string" nocase
    
    condition:
        $ps1 and (2 of ($ps2, $ps3, $ps4, $ps5, $ps6, $ps7, $ps8, $ps9))
}

rule Ransomware_File_Extensions {
    meta:
        description = "Detects files with known ransomware extensions"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "critical"
        category = "ransomware"
    
    strings:
        $ext1 = ".encrypted" nocase
        $ext2 = ".locked" nocase
        $ext3 = ".crypto" nocase
        $ext4 = ".crypt" nocase
        $ext5 = ".locky" nocase
        $ext6 = ".wcry" nocase
        $ext7 = ".wncry" nocase
        $ext8 = ".wncryt" nocase
        $ext9 = ".cerber" nocase
        $ext10 = ".zepto" nocase
    
    condition:
        any of them
}

rule Suspicious_Batch_Commands {
    meta:
        description = "Detects suspicious batch file commands"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "medium"
        category = "suspicious"
    
    strings:
        $cmd1 = "del /f /q" nocase
        $cmd2 = "vssadmin delete shadows" nocase
        $cmd3 = "bcdedit /set" nocase
        $cmd4 = "wmic shadowcopy delete" nocase
        $cmd5 = "reg add" nocase
        $cmd6 = "schtasks /create" nocase
        $cmd7 = "net stop" nocase
        $cmd8 = "taskkill /f" nocase
    
    condition:
        2 of them
}

rule Generic_Malware_Strings {
    meta:
        description = "Generic suspicious strings found in malware"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "medium"
        category = "generic"
    
    strings:
        $s1 = "keylogger" nocase
        $s2 = "backdoor" nocase
        $s3 = "rootkit" nocase
        $s4 = "trojan" nocase
        $s5 = "rat server" nocase
        $s6 = "reverse shell" nocase
        $s7 = "C&C" nocase
        $s8 = "botnet" nocase
        $s9 = "ransomware" nocase
        $s10 = "cryptolocker" nocase
    
    condition:
        2 of them
}

rule Suspicious_Registry_Persistence {
    meta:
        description = "Detects registry persistence mechanisms"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "high"
        category = "persistence"
    
    strings:
        $reg1 = "CurrentVersion\\Run" nocase
        $reg2 = "CurrentVersion\\RunOnce" nocase
        $reg3 = "CurrentVersion\\Policies\\Explorer\\Run" nocase
        $reg4 = "CurrentVersion\\Windows\\Load" nocase
        $reg5 = "Control\\Session Manager\\BootExecute" nocase
    
    condition:
        any of them
}

rule Packed_Executable_Indicators {
    meta:
        description = "Detects indicators of packed/encrypted executables"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "medium"
        category = "packer"
    
    strings:
        $upx = "UPX!"
        $aspack = "ASPack"
        $mpress = ".MPRESS"
        $vmprotect = "VMProtect"
        $themida = "Themida"
        $obsidium = "Obsidium"
    
    condition:
        any of them
}

rule Network_IOC_Patterns {
    meta:
        description = "Detects suspicious network-related patterns"
        author = "MalGuard"
        date = "2025-01-01"
        severity = "high"
        category = "network"
    
    strings:
        $ip_regex = /\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b/
        $onion = ".onion"
        $pastebin = "pastebin.com"
        $raw_paste = "raw.githubusercontent.com"
        $discord_hook = "discord.com/api/webhooks"
        $telegram = "api.telegram.org"
    
    condition:
        2 of them
}
